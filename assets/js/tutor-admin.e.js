jQuery(document).ready(function(i){"use strict";const s=wp.i18n["__"];var t,e=s("Search students","tutor");function a(){jQuery().sortable&&(i(".course-contents").sortable({handle:".course-move-handle",start:function(t,e){e.placeholder.css("visibility","visible")},stop:function(t,e){o()}}),i(".tutor-lessons:not(.drop-lessons)").sortable({connectWith:".tutor-lessons",items:"div.course-content-item",start:function(t,e){e.placeholder.css("visibility","visible")},stop:function(t,e){o()}}))}function o(){var s={};i(".tutor-topics-wrap").each(function(t,e){var o=i(this),a=parseInt(o.attr("id").match(/\d+/)[0],10),n={};o.find(".course-content-item").each(function(t,e){var o=i(this),o=parseInt(o.attr("id").match(/\d+/)[0],10);n[t]=o}),s[t]={topic_id:a,lesson_ids:n}}),i("#tutor_topics_lessons_sorting").val(JSON.stringify(s))}jQuery().wpColorPicker&&i(".tutor_colorpicker").wpColorPicker(),jQuery().select2&&i(".tutor_select2").select2(),i(".tutor-option-nav-tabs li a").click(function(t){t.preventDefault();t=i(this).attr("data-tab");i(".option-nav-item").removeClass("current"),i(this).closest("li").addClass("current"),i(".tutor-option-nav-page").hide(),i(t).addClass("current-page").show(),window.history.pushState("obj","",i(this).attr("href"))}),i("#save_tutor_option").click(function(t){t.preventDefault(),i(this).closest("form").submit()}),i("#tutor-option-form").submit(function(t){t.preventDefault();var e=i(this),t=e.serializeObject();i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:t,beforeSend:function(){e.find(".button").addClass("tutor-updating-message")},success:function(t){t.success?tutor_toast(s("Saved","tutor"),e.data("toast_success_message"),"success"):tutor_toast(s("Request Error","tutor"),s("Could not save","tutor"),"error")},complete:function(){e.find(".button").removeClass("tutor-updating-message")}})}),i(document).on("click",".withdraw-method-nav li a",function(t){t.preventDefault();t=i(this).attr("data-target-id");i(".withdraw-method-form-wrap").hide(),i("#"+t).show()}),a(),i(document).on("click",".update_lesson_modal_btn",function(t){t.preventDefault();var e=i(this),o="tutor_lesson_modal_editor",t=tinyMCE.get(o),t=t?t.getContent():i("#"+o).val(),o=i(this).closest("form").serializeObject();o.lesson_content=t,i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:o,beforeSend:function(){e.addClass("tutor-updating-message")},success:function(t){t.success&&(i("#tutor-course-content-wrap").html(t.data.course_contents),a(),i(".tutor-lesson-modal-wrap").removeClass("show"),tutor_toast(s("Lesson Updated","tutor"),e.data("toast_success_message"),"success"))},complete:function(){e.removeClass("tutor-updating-message")}})}),i(document).on("change",".tutor_lesson_video_source",function(t){var e=i(this).val();i('[class^="video_source_wrap"]').hide(),i(".video_source_wrap_"+e).show(),"html5"===e?i(".tutor-video-poster-field").show():i(".tutor-video-poster-field").hide()}),i(document).on("click",".video_source_wrap_html5 .video_upload_btn",function(t){t.preventDefault();var e,o=i(this);e||(e=wp.media({title:s("Select or Upload Media Of Your Choice","tutor"),button:{text:s("Upload media","tutor")},library:{type:"video"},multiple:!1})).on("select",function(){var t=e.state().get("selection").first().toJSON();o.closest(".video_source_wrap_html5").find("span.video_media_id").data("video_url",t.url).text(t.id).trigger("paste").closest("p").show(),o.closest(".video_source_wrap_html5").find("input.input_source_video_id").val(t.id)}),e.open()}),i(document).on("click","a.tutor-delete-attachment",function(t){t.preventDefault(),i(this).closest(".tutor-added-attachment").remove()}),i(document).on("click",".tutorUploadAttachmentBtn",function(t){t.preventDefault();var a,n=i(this);a||(a=wp.media({title:s("Select or Upload Media Of Your Choice","tutor"),button:{text:s("Upload media","tutor")},multiple:!0})).on("select",function(){var t=a.state().get("selection").toJSON();if(t.length)for(var e=0;e<t.length;e++){var o=t[e],o='<div class="tutor-added-attachment"><i class="tutor-icon-archive"></i> <a href="javascript:;" class="tutor-delete-attachment tutor-icon-line-cross"></a> <span> <a href="'+o.url+'">'+o.filename+'</a> </span><input type="hidden" name="tutor_attachments[]" value="'+o.id+'"></div>';n.closest(".tutor-lesson-attachments-metabox").find(".tutor-added-attachments-wrap").append(o)}}),a.open()}),_tutorobject.open_tutor_admin_menu&&((t=i("#adminmenu")).find('[href="admin.php?page=tutor"]').closest("li.wp-has-submenu").addClass("wp-has-current-submenu"),t.find('[href="admin.php?page=tutor"]').closest("li.wp-has-submenu").find("a.wp-has-submenu").removeClass("wp-has-current-submenu").addClass("wp-has-current-submenu")),i(document).on("click",".tutor-option-media-upload-btn",function(t){t.preventDefault();var e,o=i(this);e||(e=wp.media({title:s("Select or Upload Media Of Your Choice","tutor"),button:{text:s("Upload media","tutor")},multiple:!1})).on("select",function(){var t=e.state().get("selection").first().toJSON();o.closest(".option-media-wrap").find(".option-media-preview").html('<img src="'+t.url+'" alt="" />'),o.closest(".option-media-wrap").find("input").val(t.id),o.closest(".option-media-wrap").find(".tutor-media-option-trash-btn").show()}),e.open()}),i(document).on("click",".tutor-media-option-trash-btn",function(t){t.preventDefault();t=i(this);t.closest(".option-media-wrap").find("img").remove(),t.closest(".option-media-wrap").find("input").val(""),t.closest(".option-media-wrap").find(".tutor-media-option-trash-btn").hide()}),i(document).on("change",".tutor_addons_list_item",function(t){var e=i(this),o=e.prop("checked")?1:0,e=e.attr("name");i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:{isEnable:o,addonFieldName:e,action:"addon_enable_disable"},success:function(t){t.success}})}),i(document).on("submit","#new-instructor-form",function(t){t.preventDefault();var o=i(this),t=o.serializeObject();t.action="tutor_add_instructor",i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:t,success:function(t){var a,e;t.success?(o.trigger("reset"),i("#form-response").html('<p class="tutor-status-approved-context">'+t.data.msg+"</p>")):(a="",(e=t.data.errors)&&Object.keys(e).length&&(i.each(t.data.errors,function(t,e){var o;(o=e)&&"object"==typeof o&&o.constructor===Object?i.each(e,function(t,e){a+='<p class="tutor-required-fields">'+e[0]+"</p>"}):a+='<p class="tutor-required-fields">'+e+"</p>"}),i("#form-response").html(a)))}})}),i(document).on("click","a.instructor-action",function(t){t.preventDefault();var e=i(this),o=e.attr("data-action"),a=e.attr("data-instructor-id"),t=e.attr("data-prompt-message");t&&!confirm(t)||((a={instructor_id:a,action_name:o,action:"instructor_approval_action"})[o=_tutorobject.nonce_key]=_tutorobject[o],i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:a,beforeSend:function(){e.addClass("tutor-updating-message")},success:function(t){location.reload(!0)},complete:function(){e.removeClass("tutor-updating-message")}}))}),i(document).on("click",".tutor-create-assignments-btn",function(t){t.preventDefault();var e=i(this),o=i(this).attr("data-topic-id"),a=i("#post_ID").val();i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:{topic_id:o,course_id:a,action:"tutor_load_assignments_builder_modal"},beforeSend:function(){e.addClass("tutor-updating-message")},success:function(t){i(".tutor-lesson-modal-wrap .modal-container").html(t.data.output),i(".tutor-lesson-modal-wrap").attr("data-topic-id",o).addClass("show"),i(document).trigger("assignment_modal_loaded",{topic_id:o,course_id:a}),tinymce.init(tinyMCEPreInit.mceInit.tutor_editor_config),tinymce.execCommand("mceRemoveEditor",!1,"tutor_assignments_modal_editor"),tinyMCE.execCommand("mceAddEditor",!1,"tutor_assignments_modal_editor")},complete:function(){quicktags({id:"tutor_assignments_modal_editor"}),e.removeClass("tutor-updating-message")}})}),i(document).on("click",".open-tutor-assignment-modal",function(t){t.preventDefault();var e=i(this),o=e.attr("data-assignment-id"),a=e.attr("data-topic-id"),n=i("#post_ID").val();i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:{assignment_id:o,topic_id:a,course_id:n,action:"tutor_load_assignments_builder_modal"},beforeSend:function(){e.addClass("tutor-updating-message")},success:function(t){i(".tutor-lesson-modal-wrap .modal-container").html(t.data.output),i(".tutor-lesson-modal-wrap").attr({"data-assignment-id":o,"data-topic-id":a}).addClass("show"),i(document).trigger("assignment_modal_loaded",{assignment_id:o,topic_id:a,course_id:n}),tinymce.init(tinyMCEPreInit.mceInit.tutor_editor_config),tinymce.execCommand("mceRemoveEditor",!1,"tutor_assignments_modal_editor"),tinyMCE.execCommand("mceAddEditor",!1,"tutor_assignments_modal_editor")},complete:function(){quicktags({id:"tutor_assignments_modal_editor"}),e.removeClass("tutor-updating-message")}})}),i(document).on("click",".update_assignment_modal_btn",function(t){t.preventDefault();var e=i(this),o="tutor_assignments_modal_editor",t=tinyMCE.get(o),t=t?t.getContent():i("#"+o).val(),o=i(this).closest("form").serializeObject();o.assignment_content=t,i.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:o,beforeSend:function(){e.addClass("tutor-updating-message")},success:function(t){t.success&&(i("#tutor-course-content-wrap").html(t.data.course_contents),a(),i(".tutor-lesson-modal-wrap").removeClass("show"),tutor_toast(s("Assignment Updated","tutor"),e.data("toast_success_message"),"success"))},complete:function(){e.removeClass("tutor-updating-message")}})}),i(document).on("click",".add-assignment-attachments",function(t){t.preventDefault();var o,a=i(this);o||(o=wp.media({title:s("Select or Upload Media Of Your Choice","tutor"),button:{text:s("Upload media","tutor")},multiple:!1})).on("select",function(){var t=o.state().get("selection").first().toJSON(),e='<div class="tutor-individual-attachment-file"><p class="attachment-file-name">'+t.filename+'</p><input type="hidden" name="tutor_assignment_attachments[]" value="'+t.id+'"><a href="javascript:;" class="remove-assignment-attachment-a text-muted"> &times; Remove</a></div>';i("#assignment-attached-file").append(e),a.closest(".video_source_wrap_html5").find("input").val(t.id)}),o.open()}),i(document).on("click",".remove-assignment-attachment-a",function(t){t.preventDefault(),i(this).closest(".tutor-individual-attachment-file").remove()}),i(document).on("click",".tutor_video_poster_upload_btn",function(t){t.preventDefault();var e,o=i(this);e||(e=wp.media({title:s("Select or Upload Media Of Your Choice","tutor"),button:{text:s("Upload media","tutor")},multiple:!1})).on("select",function(){var t=e.state().get("selection").first().toJSON();o.closest(".tutor-video-poster-wrap").find(".video-poster-img").html('<img src="'+t.sizes.thumbnail.url+'" alt="" />'),o.closest(".tutor-video-poster-wrap").find("input").val(t.id)}),e.open()}),i(document).on("change","#tutor_pmpro_membership_model_select",function(t){t.preventDefault(),"category_wise_membership"===i(this).val()?i(".membership_course_categories").show():i(".membership_course_categories").hide()}),i(document).on("change","#tutor_pmpro_membership_model_select",function(t){t.preventDefault(),"category_wise_membership"===i(this).val()?i(".membership_course_categories").show():i(".membership_course_categories").hide()}),i(document).on("submit",".pmpro_admin form",function(t){var e=i(this);e.find('input[name="tutor_action"]').length&&("category_wise_membership"!=e.find('[name="tutor_pmpro_membership_model"]').val()||e.find(".membership_course_categories input:checked").length||confirm(s("Do you want to save without any category?","tutor"))||t.preventDefault())}),i("#select2_search_user_ajax").select2({allowClear:!0,minimumInputLength:1,placeholder:e,language:{inputTooShort:function(){return s("Please add 1 or more character","tutor")}},escapeMarkup:function(t){return t},ajax:{url:window._tutorobject.ajaxurl,type:"POST",dataType:"json",delay:1e3,data:function(t){return{term:t.term,action:"tutor_json_search_students"}},processResults:function(t){var o=[];return t&&i.each(t,function(t,e){o.push({id:t,text:e})}),{results:o}},cache:!0}}),i(document).on("click","table.enrolments .delete a",function(t){t.preventDefault();var e=i(this).attr("href"),t={title:s("Delete this enrolment","tutor"),description:s("All of the course data like quiz attempts, assignment, lesson <br/>progress will be deleted if you delete this student's enrollment.","tutor"),buttons:{reset:{title:s("Cancel","tutor"),class:"secondary",callback:function(){o.remove()}},keep:{title:s("Yes, Delete This","tutor"),class:"primary",callback:function(){window.location.replace(e)}}}},o=new window.tutor_popup(i,"icon-trash",40).popup(t)});e=i('#tutor-attach-product [name="tutor_course_price_type"]');0==e.length?i("#_tutor_is_course_public_meta_checkbox").show():e.change(function(){var t;i(this).prop("checked")&&(t="paid"==i(this).val()?"hide":"show",i("#_tutor_is_course_public_meta_checkbox")[t]())}).trigger("change"),i(document).on("click",".instructor-layout-template",function(){i(".instructor-layout-template").removeClass("selected-template"),i(this).addClass("selected-template")}),i("#preview-action a.preview").click(function(t){var e=i(this).attr("href");e&&(t.preventDefault(),window.open(e,"_blank"))})});